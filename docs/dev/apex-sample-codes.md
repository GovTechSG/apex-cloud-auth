# Sample Codes

These are sample codes to help the Developer in coding for the JWT header.  Do note that these are for reference only and not intended for production use.

## Node JS

```
'use strict';

// DEPENDENCIES
const crypto = require('crypto');
const fs = require('fs');
const jose = require('jose');
const jwt = require('jsonwebtoken');
const {v4: uuidv4} = require('uuid');

/*
    ***** FUNCTION TO RETURN SHA-256 ENCODING *****
*/
function hash(string) {
  return crypto.createHash('sha256').update(string).digest('hex');
}

/*
    ***** FUNCTION TO RETURN PRIVATE KEY IN PKCS8 FORMAT *****
*/
const importKey = async(key) => {
  const importedKey = await jose.importJWK(key, 'ES256')
  const privateKeyPKCS8 = await jose.exportPKCS8(importedKey);
  return privateKeyPKCS8;
}

/*
    ***** FUNCTION TO GENERATE JWT ******
*/
const getJWT = async (iss, sub, kid, aud, data, privateKey) => {

  /*
      ***** GET THE PKCS8 Signing Key *****
      This can be from a file or generated by a JWK in Endian format.
  */
  // const caPrivateKey = fs.readFileSync('./private.key', 'utf8'); 
  const caPrivateKey = await importKey(privateKey);

  /* 
      ***** ADD THE JWT SIGNING OPTIONS ******
      The signing options are adding here based on function input.
      Isseud at time, or 'iat' is added by the library.
  */
  const signOptions = {
    algorithm: 'ES256',
    keyid: kid,
    expiresIn: '180s',
    jwtid: uuidv4(),
    issuer: iss,
    audience: aud,
    subject: sub,
  };
  const payload = {
    data: data,
  };

  /*  
      ***** CREATE JWT *****
      The JWT is created here to be used for the authentication header.
  */
  const jwtAuth = jwt.sign(payload, caPrivateKey, signOptions);
  console.log(`JWT Signing Options-\n${JSON.stringify(signOptions)}\n`);
  console.log(`Additional JWT Payload-\n${JSON.stringify(payload)}\n`);
  console.log(`JWT-\n${jwtAuth}\n`);
  return jwtAuth;
};

/*
    ***** START OF PROGRAM *****
*/

/*
    ***** DEFINE SIGNING VARIABLES *****
    This is a sample private key.  In a real scenario this will be in a secure vault and should not be in program code.

    Here the following JWT claims are defined:
    - issuer
    - subject
    - key ID
    - audience
    - JSON payload
    - private key
    - payload hash (data)
*/
const issuer = 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxx,yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyy';
const subject = 'POST';
const keyId = 'apex-example';
const audience = 'https://public-stg.api.gov.sg/agency/api';

const privateKey = {
  kty: 'EC',
  crv: 'P-256',
  x: 'usZhq9AL4aC-hkzGCBK3RuJjmxKE6zqEdFyp-tQ8kh4',
  y: 'wHI1r6rQCHQQSAdNxaJDA0Tw5Fq3B-icq-mbMVlLZA4',
  d: 'w55YEByLRumO-Rnsc8jg2_MaYXfEiT_ioFVoGgrCTlg',
  use: 'sig',
  kid: 'apex-example',
  alg: 'ES256',
};

const payload = {payload: 'data'};
const payloadString = JSON.stringify(payload);
const data = hash(payloadString);
console.log(`Payload-\n${payloadString}\n`);
console.log(`Hash-\n${data}\n`);

getJWT(issuer, subject, keyId, audience, data, privateKey);

```
<!-- TODO: Include Sample Code for JAVA -->

<!-- TODO: Include Sample Code for C# -->
